openapi: 3.0.3
info:
  title: AI-Native Textbook API
  description: API for the Physical AI & Humanoid Robotics textbook application
  version: 1.0.0
servers:
  - url: https://api.example.com/v1
    description: Production server
  - url: https://staging-api.example.com/v1
    description: Staging server

paths:
  /auth/register:
    post:
      summary: Register a new user
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: Invalid input
        '409':
          description: User already exists

  /auth/login:
    post:
      summary: Login user
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials

  /modules:
    get:
      summary: Get all content modules
      tags:
        - Content
      parameters:
        - name: module_type
          in: query
          schema:
            type: string
            enum: [ros2, gazebo_unity, nvidia_isaac, vla]
          description: Filter by module type
        - name: week_number
          in: query
          schema:
            type: integer
          description: Filter by week number (1-13)
      responses:
        '200':
          description: List of content modules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContentModuleResponse'

  /modules/{module_id}:
    get:
      summary: Get a specific content module
      tags:
        - Content
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Content module details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentModuleWithContentResponse'
        '404':
          description: Module not found

  /modules/{module_id}/interactive-elements:
    get:
      summary: Get interactive elements for a module
      tags:
        - Content
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of interactive elements
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InteractiveElementResponse'

  /assessments:
    get:
      summary: Get all assessments
      tags:
        - Assessments
      parameters:
        - name: module_id
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by module
      responses:
        '200':
          description: List of assessments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AssessmentResponse'

  /assessments/{assessment_id}:
    get:
      summary: Get a specific assessment
      tags:
        - Assessments
      parameters:
        - name: assessment_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Assessment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssessmentWithQuestionsResponse'
        '404':
          description: Assessment not found

  /assessments/{assessment_id}/submit:
    post:
      summary: Submit an assessment
      tags:
        - Assessments
      parameters:
        - name: assessment_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssessmentSubmission'
      responses:
        '200':
          description: Assessment submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssessmentResult'
        '400':
          description: Invalid submission

  /chat/sessions:
    get:
      summary: Get user's chat sessions
      tags:
        - Chatbot
      responses:
        '200':
          description: List of chat sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChatSessionResponse'
    post:
      summary: Create a new chat session
      tags:
        - Chatbot
      responses:
        '201':
          description: Chat session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatSessionResponse'

  /chat/sessions/{session_id}/messages:
    get:
      summary: Get messages in a chat session
      tags:
        - Chatbot
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChatMessageResponse'
    post:
      summary: Send a message to the chatbot
      tags:
        - Chatbot
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatMessageRequest'
      responses:
        '200':
          description: Response from chatbot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatMessageResponse'

  /user/profile:
    get:
      summary: Get user profile
      tags:
        - User
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
    put:
      summary: Update user profile
      tags:
        - User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileUpdate'
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'

  /user/progress:
    get:
      summary: Get user progress
      tags:
        - User
      responses:
        '200':
          description: User progress summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProgressResponse'

  /user/progress/{module_id}:
    get:
      summary: Get progress for a specific module
      tags:
        - User
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Module progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModuleProgressResponse'

components:
  schemas:
    UserRegistration:
      type: object
      required:
        - email
        - password
        - name
        - role
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        name:
          type: string
        role:
          type: string
          enum: [student, educator, professional]

    UserLogin:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    UserResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [student, educator, professional]

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        user:
          $ref: '#/components/schemas/UserResponse'

    ContentModuleResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        module_type:
          type: string
          enum: [ros2, gazebo_unity, nvidia_isaac, vla]
        week_number:
          type: integer
        created_at:
          type: string
          format: date-time

    ContentModuleWithContentResponse:
      allOf:
        - $ref: '#/components/schemas/ContentModuleResponse'
        - type: object
          properties:
            content:
              type: string
              description: MDX content for the module
            prerequisites:
              type: array
              items:
                type: string
                format: uuid
            learning_outcomes:
              type: array
              items:
                type: string

    InteractiveElementResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        type:
          type: string
          enum: [code_example, urdf_snippet, quiz, exercise]
        content:
          type: string
        difficulty:
          type: string
          enum: [beginner, intermediate, advanced]
        language:
          type: string

    AssessmentResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        module_id:
          type: string
          format: uuid
        max_score:
          type: integer

    AssessmentWithQuestionsResponse:
      allOf:
        - $ref: '#/components/schemas/AssessmentResponse'
        - type: object
          properties:
            questions:
              type: array
              items:
                $ref: '#/components/schemas/Question'

    Question:
      type: object
      properties:
        id:
          type: string
          format: uuid
        text:
          type: string
        type:
          type: string
          enum: [multiple_choice, short_answer, code]
        options:
          type: array
          items:
            type: string
        correct_answer:
          type: string

    AssessmentSubmission:
      type: object
      required:
        - answers
      properties:
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerSubmission'

    AnswerSubmission:
      type: object
      properties:
        question_id:
          type: string
          format: uuid
        answer:
          type: string

    AssessmentResult:
      type: object
      properties:
        score:
          type: number
          format: float
        max_score:
          type: integer
        percentage:
          type: number
          format: float

    ChatSessionResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ChatMessageRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string

    ChatMessageResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        role:
          type: string
          enum: [user, assistant]
        content:
          type: string
        source_documents:
          type: array
          items:
            type: string
            format: uuid
        created_at:
          type: string
          format: date-time

    UserProfileResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        preferences:
          type: object
          additionalProperties: true

    UserProfileUpdate:
      type: object
      properties:
        preferences:
          type: object
          additionalProperties: true

    UserProgressResponse:
      type: object
      properties:
        total_modules:
          type: integer
        completed_modules:
          type: integer
        overall_progress:
          type: number
          format: float
        modules_progress:
          type: array
          items:
            $ref: '#/components/schemas/ModuleProgressSummary'

    ModuleProgressSummary:
      type: object
      properties:
        module_id:
          type: string
          format: uuid
        title:
          type: string
        progress:
          type: number
          format: float
        completed:
          type: boolean

    ModuleProgressResponse:
      type: object
      properties:
        module_id:
          type: string
          format: uuid
        progress:
          type: number
          format: float
        completed:
          type: boolean
        assessments:
          type: array
          items:
            $ref: '#/components/schemas/AssessmentProgress'
        last_accessed:
          type: string
          format: date-time

    AssessmentProgress:
      type: object
      properties:
        assessment_id:
          type: string
          format: uuid
        title:
          type: string
        score:
          type: number
          format: float
        completed:
          type: boolean